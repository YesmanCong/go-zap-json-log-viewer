---
description: 扩展实现详情，包括主要组件和数据流
globs: 
alwaysApply: false
---
# 扩展实现详情

## 主要组件

[src/extension.ts](mdc:src/extension.ts)文件是扩展的核心，包含以下主要组件和功能：

### 1. 全局变量和状态

- `severityColors` - 存储不同日志级别对应的颜色
- `isEnabled` - 跟踪插件是否启用
- `logOutputChannel` - VSCode输出通道，用于显示格式化的日志
- `webviewPanel` - WebView面板，用于彩色日志视图
- `decorationTypes` - 文本编辑器装饰器类型，用于高亮不同级别的日志

### 2. 主要功能模块

- 文本装饰器 (36-135行) - 在编辑器中根据severity字段为日志行应用颜色高亮
- WebView日志查看器 (136-221行) - 创建和维护彩色日志查看面板
- 调试输出处理 (305-393行) - 捕获、解析和格式化调试过程中的日志输出
- 事件监听和处理 (394-444行) - 监听编辑器、文档和调试会话的各种事件

### 3. 配置管理

- 颜色配置 (13-28行) - 从VSCode设置中读取和应用颜色配置
- 命令注册 (71-95行) - 注册扩展提供的命令

## 数据流

1. 日志输入来源：
   - 文件中的JSON格式日志
   - 调试会话中输出的日志

2. 日志处理流程：
   - 解析JSON或结构化文本
   - 提取severity、时间戳、消息等信息
   - 根据severity应用相应的颜色样式

3. 日志显示方式：
   - 编辑器内文本高亮
   - 彩色WebView面板
   - VSCode输出通道
